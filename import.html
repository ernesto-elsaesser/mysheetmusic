<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicXML Import</title>
    <script src="zip.js"></script>
    <link rel="stylesheet" href="style.css?v=20250418" />
</head>
<body>
    <div id="content">
        <h1>MusicXML Import</h1>
        <p>
            <input type="file" id="file" name="file" accept=".mxl">
        <p>
        <form action="songs.php" method="POST">
            <label for="name">Title:</label> <input type="text" id="name" name="name" size="48"><br/>
            <input type="text" id="data" name="data" hidden><br/>
            <input type="submit"><br/>
        </form>
    </div>

    <script>
        const fileInput = document.getElementById('file')
        const nameInput = document.getElementById('name')
        const dataInput = document.getElementById('data')

        fileInput.addEventListener('change', (event) => {

            dataInput.value = ""

            const file = event.target.files[0]
            if (file == undefined) return

            nameInput.value = file.name.replace("_", " ")

            const reader = new FileReader()
            reader.onload = async (event) => {
                const array = new Uint8Array(event.target.result)
                const rawReader = new zip.Uint8ArrayReader(array)
                const reader = new zip.ZipReader(rawReader)
                const entries = await reader.getEntries()
                for (let entry of entries) {
                    if (entry.filename != "score.xml") continue;
                    const writer = new zip.TextWriter()
                    dataInput.value = await entry.getData(writer)
                }
                await reader.close()
            }
            reader.onerror = () => {
                window.alert("can't read file!")
            }
            reader.readAsArrayBuffer(file)
        })
    </script>
</body>
</html>